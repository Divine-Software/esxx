<?xml version="1.0"?>

<project name="esxx" default="compile">
  <description>esxx build file</description>

  <property name="src.dir"     location="src"/>
  <property name="build.dir"   location="build"/>
  <property name="classes.dir" location="${build.dir}/classes"/>
  <property name="lib.dir"     location="lib"/>
  <property name="dist.dir"    location="dist"/>

  <property name="main-class"  value="org.blom.martin.esxx.CommandLine"/>

  <path id="classpath">
    <pathelement path="${classes.dir}"/>
    <fileset dir="${lib.dir}" includes="**/*.jar"/>
  </path>

  <target name="init">
    <tstamp/>
    <mkdir dir="${classes.dir}"/>
  </target>

  <target name="compile" depends="init" description="compile everything">
    <javac srcdir="${src.dir}" destdir="${classes.dir}" classpathref="classpath"/>
  </target>

  <target name="dist" depends="compile" description="generate the distribution" >
    <mkdir dir="${dist.dir}"/>

    <copy todir="${dist.dir}">
      <fileset dir="" includes="LICENSE*,README"/>
    </copy>

    <mkdir dir="${dist.dir}/lib"/>
    <jar jarfile="${dist.dir}/lib/${ant.project.name}.jar" basedir="${classes.dir}">
      <zipgroupfileset dir="${lib.dir}" includes="*.jar"/>
      <manifest>
        <attribute name="Main-Class" value="${main-class}"/>
      </manifest>
    </jar>

    <mkdir dir="${dist.dir}/examples"/>
    <copy todir="${dist.dir}/examples">
      <fileset dir="" includes="test*"/>
    </copy>
  </target>

  <target name="clean" description="clean up" >
    <delete dir="${build.dir}"/>
    <delete dir="${dist.dir}"/>
  </target>

  <target name="run" depends="compile">
    <java classname="${main-class}" fork="true" classpathref="classpath">
      <arg file="test-code.esxx" />
    </java>

<!--
    <java classname="${main-class}" fork="true" classpathref="classpath">
      <arg file="test-xml.esxx" />
    </java>

    <java classname="${main-class}" fork="true" classpathref="classpath">
      <arg file="test-xslt.esxx" />
    </java>

    <java classname="${main-class}" fork="true" classpathref="classpath">
      <arg file="test-code.esxx" />
    </java>
-->
  </target>
</project>
